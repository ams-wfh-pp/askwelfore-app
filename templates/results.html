<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Your WelFore Personalized Plan</title>
  <style>
    :root{
      --bg1:#667eea; --bg2:#764ba2;
      --ink:#2d3748; --muted:#4a5568; --soft:#f7fafc; --card:#ffffff;
      --accent:#6157f8; --accent2:#f5576c; --ok:#48bb78; --shadow:0 20px 60px rgba(0,0,0,.20);
    }
    *{box-sizing:border-box}
    body{
      margin:0; padding:20px; font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;
      background:linear-gradient(135deg,var(--bg1) 0%, var(--bg2) 100%); min-height:100vh;
    }
    .container{max-width:900px; margin:0 auto; background:var(--card); border-radius:16px; padding:28px; box-shadow:var(--shadow)}
    .brand{
      display:flex; align-items:center; gap:12px; margin-bottom:8px; justify-content:center;
    }
    .brand img{height:44px; width:auto}
    .badge{display:inline-block; background:#eef2ff; color:#4338ca; padding:6px 10px; border-radius:999px; font-size:.85rem; font-weight:700}
    .header{ text-align:center; margin:16px 0 22px}
    .header h1{color:var(--ink); font-size:1.9rem; margin:.2rem 0}
    .header p{color:var(--muted); line-height:1.55}
    /* Flavor Balance Index */
    .fbi{
      background:linear-gradient(135deg,#e0f7fa,#f1f8e9); border-radius:14px; padding:22px; text-align:center; margin:20px 0 26px;
      box-shadow:0 8px 18px rgba(0,0,0,.06)
    }
    .fbi h2{margin:0 0 6px; color:#2b6cb0; font-size:1.25rem}
    .fbi .score{font-size:2.6rem; font-weight:800; color:#2b6cb0}
    .fbi p{margin:8px 0 0; color:#234e70}
    /* Upsell */
    .upsell{
      background:linear-gradient(135deg,#f093fb 0%, var(--accent2) 100%); color:#fff; border-radius:14px; padding:20px; text-align:center; margin:10px 0 26px;
    }
    .upsell h3{margin:0 0 6px; font-size:1.25rem}
    .btn{
      display:inline-block; text-decoration:none; font-weight:700; padding:12px 20px; border-radius:10px; margin-top:10px; background:#fff; color:#f5576c;
      transition:transform .15s ease
    }
    .btn:hover{transform:translateY(-2px)}
    /* Summary grid */
    .summary{background:var(--soft); border-radius:14px; padding:16px; margin:0 0 24px}
    .summary h3{margin:0 0 10px; color:var(--ink)}
    .grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:12px}
    .info{background:#fff; border-left:3px solid var(--accent); border-radius:10px; padding:10px 12px}
    .label{font-size:.82rem; color:#718096}
    .value{font-weight:700; color:var(--ink)}
    /* Days */
    .days h3{color:var(--ink); margin:6px 0 14px}
    details.day{background:var(--soft); border-radius:14px; margin:0 0 14px; border-left:4px solid var(--accent); overflow:hidden}
    summary{
      list-style:none; cursor:pointer; padding:14px 16px; display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    summary::-webkit-details-marker{display:none}
    .day-title{font-weight:800; color:#4c51bf}
    .day-sub{color:#5a677a; font-size:.95rem}
    .content{padding:0 16px 16px}
    .section{background:#fff; border-radius:10px; padding:12px; margin:10px 0}
    .section h4{margin:0 0 6px; color:#334155; font-size:1rem}
    .meal{color:#4a5568}
    .chips{display:flex; flex-wrap:wrap; gap:8px; margin-top:8px}
    .chip{padding:4px 10px; border-radius:999px; font-weight:700; font-size:.8rem}
    .red{background:#fed7d7; color:#c53030}
    .orange{background:#feebc8; color:#c05621}
    .yellow{background:#fefcbf; color:#975a16}
    .green{background:#c6f6d5; color:#22543d}
    .purple{background:#e9d8fd; color:#553c9a}
    .white{background:#e2e8f0; color:#2d3748}
    .count{font-weight:800; color:#4c51bf}
    /* PDFs */
    .pdfs{background:var(--soft); border-radius:14px; padding:16px; margin:18px 0}
    .pdf{background:#fff; border-left:3px solid var(--ok); border-radius:10px; padding:12px; margin:10px 0}
    .pdf h4{margin:0 0 4px; color:var(--ink)}
    .pdf p{margin:0; color:#5f6b7a}
    /* Flavor boosts footer */
    .boosts{background:linear-gradient(135deg,#fff7ed,#fef3c7); border-radius:16px; padding:18px; margin:22px 0; text-align:center}
    .boosts h3{margin:0 0 8px; color:#9a3412}
    .boosts p{margin:0; color:#78350f}
    /* Footer */
    .foot{margin-top:18px; text-align:center; font-size:.85rem; color:#6b7280}
    @media (min-width:760px){
      summary{padding:16px 18px}
      .content{padding:0 18px 18px}
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Brand -->
    <div class="brand">
      <img src="/static/WelFore-Health-logo.png" alt="WelFore Health" />
      <span class="badge">Digital Health Hub Global Finalist ‚Ä¢ Wellness & Prevention 2025</span>
    </div>

    <!-- Header -->
    <div class="header">
      <h1>üåà Your Personalized Wellness Plan</h1>
      <p><strong>{{ meal_plan.user_name }}</strong>, here‚Äôs your flavor-forward plan designed to reach your <strong>{{ meal_plan.health_goal }}</strong> goal‚Äîwithout giving up the foods you love.</p>
    </div>

    <!-- Flavor Balance Index -->
    {% if flavor_balance_index %}
    <div class="fbi">
      <h2>üåø Your Flavor Balance Index</h2>
      <div class="score">{{ flavor_balance_index }}/100</div>
      {% if flavor_balance_index >= 90 %}
        <p>üî• Incredible! Balanced colors & flavors like a pro chef.</p>
      {% elif flavor_balance_index >= 80 %}
        <p>üåø Great work‚Äîtoday‚Äôs plates are vibrant and confident.</p>
      {% else %}
        <p>üåà You‚Äôre off to a delicious start‚Äîadd one more color tomorrow for a boost.</p>
      {% endif %}
    </div>
    {% endif %}

    <!-- Upsell (freemium-safe): show if a longer plan is available -->
    {% if meal_plan.stripe_link and meal_plan.plan_duration < 7 %}
    <div class="upsell">
      <h3>‚ú® Ready for the Full Reset?</h3>
      <p>Unlock the complete {{ 7 if meal_plan.plan_duration < 7 else meal_plan.plan_duration }}-day FlavURWay plan with shopping lists, tips & momentum boosters.</p>
      <a class="btn" href="{{ meal_plan.stripe_link }}" target="_blank" rel="noopener">Upgrade to Premium ‚Üí</a>
    </div>
    {% endif %}

    <!-- Summary -->
    <div class="summary">
      <h3>üìã Plan Overview</h3>
      <div class="grid">
        <div class="info"><div class="label">Duration</div><div class="value">{{ meal_plan.plan_duration }} days</div></div>
        <div class="info"><div class="label">Primary Cuisine</div><div class="value">{{ meal_plan.primary_cuisine }}</div></div>
        <div class="info"><div class="label">Avg Colors / Day</div><div class="value">{{ meal_plan.average_colors_per_day }}</div></div>
        <div class="info"><div class="label">Daily Protein</div><div class="value">{{ meal_plan.nutrition_targets.protein_daily }}</div></div>
        <div class="info"><div class="label">Daily Fiber</div><div class="value">{{ meal_plan.nutrition_targets.fiber_daily }}</div></div>
        <div class="info"><div class="label">Hydration Goal</div><div class="value">{{ meal_plan.nutrition_targets.hydration }}</div></div>
      </div>
    </div>

    <!-- Days -->
    <div class="days">
      <h3>üçΩÔ∏è Your Daily Meal Plan</h3>

      {% set themes = [
        'Heritage Harmony ‚Äî familiar flavors, bright colors.',
        'Light & Balanced ‚Äî crisp, fresh, energizing.',
        'Comfort & Color ‚Äî warm plates with brightness.',
        'Family Favorites ‚Äî simple, satisfying, joyful.',
        'Fresh & Fiber-Filled ‚Äî color + crunch.',
        'Caribbean Bright ‚Äî tangy, sunny, vibrant.'
      ] %}

      {% for day in meal_plan.meal_plan %}
      {% set theme = themes[(loop.index0) % themes|length] %}
      <details class="day" {% if loop.first %}open{% endif %}>
        <summary>
          <div>
            <div class="day-title">Day {{ day.day }} ‚Ä¢ {{ theme }}</div>
            <div class="day-sub">Colors: <span class="count">{{ day.colors_achieved }}</span></div>
          </div>
          <div aria-hidden="true">‚ñº</div>
        </summary>
        <div class="content">

          {# Build structured sections from the free-form meal strings #}
          {% set ns = namespace(breakfast='', lunch='', dinner='', snacks=[], hydration='', goals='') %}
          {% for m in day.meals %}
            {% if 'Breakfast:' in m %}{% set ns.breakfast = m.split('Breakfast:')[1].strip() %}
            {% elif 'Lunch:' in m %}{% set ns.lunch = m.split('Lunch:')[1].strip() %}
            {% elif 'Dinner:' in m %}{% set ns.dinner = m.split('Dinner:')[1].strip() %}
            {% elif 'Snack:' in m %}{% set _ = ns.snacks.append(m.split('Snack:')[1].strip()) %}
            {% elif 'Hydration:' in m %}{% set ns.hydration = m.split('Hydration:')[1].strip() %}
            {% elif 'Daily Goals:' in m %}{% set ns.goals = m.split('Daily Goals:')[1].strip() %}
            {% endif %}
          {% endfor %}

          <div class="section">
            <h4>Breakfast</h4>
            <div class="meal">{{ ns.breakfast or 'Chef‚Äôs choice: colorful, protein-forward start' }}</div>
          </div>
          <div class="section">
            <h4>Lunch</h4>
            <div class="meal">{{ ns.lunch or 'Greens + lean protein + whole grains' }}</div>
          </div>
          <div class="section">
            <h4>Dinner</h4>
            <div class="meal">{{ ns.dinner or 'Vegetable-forward, sauce on the side, rainbow sides' }}</div>
          </div>
          <div class="section">
            <h4>Snack Smart</h4>
            {% if ns.snacks|length > 0 %}
              {% for s in ns.snacks %}
                <div class="meal">‚Ä¢ {{ s }}</div>
              {% endfor %}
            {% else %}
              <div class="meal">Protein + Color/Grain: e.g., cottage cheese + pineapple ‚Ä¢ hummus + carrots ‚Ä¢ cheese + whole-grain crackers</div>
            {% endif %}
          </div>
          <div class="section">
            <h4>Hydration Boost</h4>
            <div class="meal">{{ ns.hydration or 'Drink 8‚Äì10 glasses water; add herbal tea or citrus-infused water.' }}</div>
          </div>
          <div class="section">
            <h4>Daily Targets</h4>
            <div class="meal">{{ ns.goals or (meal_plan.nutrition_targets.fiber_daily ~ ', ' ~ meal_plan.nutrition_targets.protein_daily) }}</div>
          </div>

          <div class="section">
            <h4>Color Palette</h4>
            <div class="chips">
              {% for c in day.colors %}
                {% set cls = 'white' %}
                {% if c == 'red' %}{% set cls='red' %}
                {% elif c == 'orange' %}{% set cls='orange' %}
                {% elif c == 'yellow' %}{% set cls='yellow' %}
                {% elif c == 'green' %}{% set cls='green' %}
                {% elif 'purple' in c or 'blue' in c %}{% set cls='purple' %}
                {% endif %}
                <span class="chip {{ cls }}">{{ c }}</span>
              {% endfor %}
            </div>
          </div>

        </div>
      </details>
      {% endfor %}
    </div>

    <!-- PDFs -->
    {% if pdf_recommendations %}
    <div class="pdfs">
      <h3>üìö Recommended Guides</h3>
      {% for pdf in pdf_recommendations %}
        <div class="pdf">
          <h4>{{ pdf.title }}</h4>
          <p>{{ pdf.description or 'Helpful companion for your reset.' }}</p>
        </div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- Flavor Boosts Footer -->
    <div class="boosts">
      <h3>üåø Flavor Boost Tips</h3>
      <p>Brighten fish with lemon zest ‚Ä¢ Lift tomato dishes with basil ‚Ä¢ Warm breakfasts with cinnamon or cardamom ‚Ä¢ Add crunch with toasted seeds.</p>
    </div>

    <!-- Footer -->
    <div class="foot">
      ¬© 2025 WelFore Health LLC. All Rights Reserved. ‚Ä¢ Powered by the FlavURWay Teaching Kitchen Collective.
    </div>
  </div>
</body>
</html>
